'use strict';const a18_0x881f69=a18_0x66fb;function a18_0x66fb(_0x423917,_0x188e2e){const _0x45d058=a18_0x45d0();return a18_0x66fb=function(_0x66fbe3,_0x8fa57c){_0x66fbe3=_0x66fbe3-0x6d;let _0x17578b=_0x45d058[_0x66fbe3];return _0x17578b;},a18_0x66fb(_0x423917,_0x188e2e);}function a18_0x45d0(){const _0x26a107=['__awaiter','./crypto/DigestHelper','logoutAccessToken','init','length','_trustedRootCert','unwrapResponse','publicKey','error','lookupUserProfile','getBytes','RETRIEVE_FACE_URL','env','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','Invalid\x20user\x20access\x20token\x20signature.','181688XkTGsJ','statusCode','ORG_ACCESS_TOKEN_URL','oids','__esModule','28TBwfkr','getUserFace','status','Invalid\x20access\x20token\x20signature','sha512','certBag','write','export','CAMDIGIKEY_CLIENT_ID','ACCESS_TOKEN_REQUEST_URL','5614696glZdAc','end','apply','refreshUserAccessToken','./error/InvalidAccessTokenTypeError','pem','binary','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','asn1','275472Gzrffn','readFileSync','ACCESS_TOKEN_REFRESH_URL','now','encode','application/json','1935602Aviakh','from','pki','requestToServer','./error/CamDigiKeyError','getBags','default','CAMDIGIKEY_API','./crypto/Wrapper','node-forge','signerCertificate','./cache/CamDigiKeyMemoryCache','createVerify','4967535SRVfDN','ACCESS_TOKEN_STATUS_URL','VERIFY_USER_PROFILE','__importDefault','getLoginToken','verify','CamDigiKeyClient','defineProperty','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE','LOGOUT_USER_ACCESS_TOKEN_URL','wrapRequest','message','LOOKUP_USER_PROFILE','verifyAccountToken','next','string','X509Certificate','4957470XPrwpa','4325968eaDcIf','done','LOGIN_TOKEN_REQUEST_URL','includes','pkcs12','spki','CAMDIGIKEY_CLIENT_DOMAIN','_cacheService','invalid.token.type','crypto','base64','pkcs12FromAsn1','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','throw','data','validateTokenSignature','then','value','toDer','Invalid\x20auth\x20token\x20signature.'];a18_0x45d0=function(){return _0x26a107;};return a18_0x45d0();}(function(_0x456ad7,_0x122797){const _0x4f8481=a18_0x66fb,_0x202a91=_0x456ad7();while(!![]){try{const _0x2aca61=parseInt(_0x4f8481(0x8e))/0x1+-parseInt(_0x4f8481(0x70))/0x2+-parseInt(_0x4f8481(0xac))/0x3+-parseInt(_0x4f8481(0xad))/0x4+-parseInt(_0x4f8481(0x9b))/0x5+parseInt(_0x4f8481(0x88))/0x6+parseInt(_0x4f8481(0x75))/0x7*(parseInt(_0x4f8481(0x7f))/0x8);if(_0x2aca61===_0x122797)break;else _0x202a91['push'](_0x202a91['shift']());}catch(_0x522b47){_0x202a91['push'](_0x202a91['shift']());}}}(a18_0x45d0,0xecf21));var __awaiter=this&&this[a18_0x881f69(0xc1)]||function(_0x53ec7e,_0x482996,_0x3486eb,_0x431830){function _0x59fd19(_0x1e4ca3){return _0x1e4ca3 instanceof _0x3486eb?_0x1e4ca3:new _0x3486eb(function(_0x1cc54c){_0x1cc54c(_0x1e4ca3);});}return new(_0x3486eb||(_0x3486eb=Promise))(function(_0x1e1ace,_0x154edf){const _0x5dc09f=a18_0x66fb;function _0x525a59(_0x321e44){const _0x5f0a3c=a18_0x66fb;try{_0x1a5253(_0x431830[_0x5f0a3c(0xa9)](_0x321e44));}catch(_0x7dfcbf){_0x154edf(_0x7dfcbf);}}function _0xb466e1(_0x4c7b97){const _0x1f97b1=a18_0x66fb;try{_0x1a5253(_0x431830[_0x1f97b1(0xba)](_0x4c7b97));}catch(_0x3bfe97){_0x154edf(_0x3bfe97);}}function _0x1a5253(_0x5b601d){const _0x3dfbb8=a18_0x66fb;_0x5b601d[_0x3dfbb8(0xae)]?_0x1e1ace(_0x5b601d[_0x3dfbb8(0xbe)]):_0x59fd19(_0x5b601d[_0x3dfbb8(0xbe)])[_0x3dfbb8(0xbd)](_0x525a59,_0xb466e1);}_0x1a5253((_0x431830=_0x431830[_0x5dc09f(0x81)](_0x53ec7e,_0x482996||[]))['next']());});},__importDefault=this&&this[a18_0x881f69(0x9e)]||function(_0xdfbd08){const _0x23c12c=a18_0x881f69;return _0xdfbd08&&_0xdfbd08[_0x23c12c(0x74)]?_0xdfbd08:{'default':_0xdfbd08};};Object[a18_0x881f69(0xa2)](exports,'__esModule',{'value':!![]}),exports[a18_0x881f69(0xa1)]=void 0x0;const Wrapper_1=__importDefault(require(a18_0x881f69(0x96))),CamDigiKeyError_1=__importDefault(require(a18_0x881f69(0x92))),InvalidAccessTokenTypeError_1=__importDefault(require(a18_0x881f69(0x83))),DigestHelper_1=__importDefault(require(a18_0x881f69(0xc2))),CamDigiKeyMemoryCache_1=__importDefault(require(a18_0x881f69(0x99))),InvalidTokenSignatureError_1=__importDefault(require('./error/InvalidTokenSignatureError')),fs_1=__importDefault(require('fs')),request_1=__importDefault(require('request')),crypto_1=__importDefault(require(a18_0x881f69(0xb6))),node_forge_1=__importDefault(require(a18_0x881f69(0x97))),api_1=require('./api'),CamDigiKeyClient=class{static[a18_0x881f69(0xc4)](){const _0x510c7f=a18_0x881f69,_0x2ea81c=fs_1[_0x510c7f(0x94)][_0x510c7f(0x89)](String(process[_0x510c7f(0x6d)][_0x510c7f(0xa3)]),_0x510c7f(0x85)),_0x1b2622=node_forge_1[_0x510c7f(0x94)][_0x510c7f(0x87)]['fromDer'](_0x2ea81c),_0x58b052=node_forge_1[_0x510c7f(0x94)][_0x510c7f(0xb1)][_0x510c7f(0xb8)](_0x1b2622,String(process['env'][_0x510c7f(0x6e)])),_0x2ecd41=_0x58b052[_0x510c7f(0x93)]({'bagType':node_forge_1[_0x510c7f(0x94)][_0x510c7f(0x90)][_0x510c7f(0x73)][_0x510c7f(0x7a)]}),_0x4a1392=_0x2ecd41[node_forge_1[_0x510c7f(0x94)][_0x510c7f(0x90)][_0x510c7f(0x73)][_0x510c7f(0x7a)]][0x0],_0x219e78={'type':'CERTIFICATE','body':node_forge_1[_0x510c7f(0x94)][_0x510c7f(0x87)][_0x510c7f(0xbf)](_0x4a1392[_0x510c7f(0x87)])[_0x510c7f(0xcb)]()},_0x4daa83=node_forge_1[_0x510c7f(0x94)][_0x510c7f(0x84)][_0x510c7f(0x8c)](_0x219e78);this[_0x510c7f(0xc6)]=new crypto_1[(_0x510c7f(0x94))][(_0x510c7f(0xab))](_0x4daa83),this[_0x510c7f(0xb4)]=new CamDigiKeyMemoryCache_1['default'](this[_0x510c7f(0xc6)]);}static[a18_0x881f69(0x91)](_0x29b99d,_0x20e0b8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5d3d71=a18_0x66fb;try{const _0xef4687=String(process[_0x5d3d71(0x6d)]['CAMDIGIKEY_SERVER_BASED_URL'])+_0x20e0b8,_0xca9709=Wrapper_1[_0x5d3d71(0x94)][_0x5d3d71(0xa5)](_0x29b99d),_0x37f93e={'url':_0xef4687,'headers':{'Content-Type':_0x5d3d71(0x8d)},'json':_0xca9709};return process[_0x5d3d71(0x6d)][_0x5d3d71(0xb9)]&&(_0x37f93e['agentOptions']={'pfx':fs_1[_0x5d3d71(0x94)][_0x5d3d71(0x89)](String(process[_0x5d3d71(0x6d)]['CAMDIGIKEY_CLIENT_KEYSTORE_FILE'])),'passphrase':String(process[_0x5d3d71(0x6d)][_0x5d3d71(0x86)])}),yield new Promise((_0x1c851f,_0x48014c)=>{const _0x336994=_0x5d3d71;request_1[_0x336994(0x94)]['post'](_0x37f93e,(_0x4a53b7,_0x376cbb,_0x55898c)=>{const _0x51f1e1=_0x336994;if(!_0x4a53b7&&_0x376cbb[_0x51f1e1(0x71)]>=0xc8&&_0x376cbb[_0x51f1e1(0x71)]<0x12c){if(_0x55898c!=null)try{const _0x5f4d4e=Wrapper_1[_0x51f1e1(0x94)][_0x51f1e1(0xc7)](_0x55898c);return _0x1c851f(_0x5f4d4e);}catch(_0x3fe1a2){return _0x48014c(_0x3fe1a2);}else return _0x1c851f({});}else return _0x48014c(new CamDigiKeyError_1[(_0x51f1e1(0x94))]('Error\x20requesting\x20to\x20CamDigiKey\x20Server.\x20Error:\x20'+(_0x4a53b7===null||_0x4a53b7===void 0x0?void 0x0:_0x4a53b7[_0x51f1e1(0xa6)])));});});}catch(_0x582f23){throw new CamDigiKeyError_1[(_0x5d3d71(0x94))](_0x582f23[_0x5d3d71(0xa6)]);}});}static['validateTokenSignature'](_0x4e46ce){var _0xb08722;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x2aa60a=a18_0x66fb;!this['_cacheService']&&this[_0x2aa60a(0xc4)]();if(typeof _0x4e46ce!==_0x2aa60a(0xaa))throw new InvalidAccessTokenTypeError_1['default'](_0x2aa60a(0xb5));_0x4e46ce['includes']('%')&&(_0x4e46ce=decodeURIComponent(_0x4e46ce));try{const _0x32409d=_0x4e46ce['split']('.');if(_0x32409d[_0x2aa60a(0xc5)]!==0x3)throw new InvalidAccessTokenTypeError_1['default']('invalid.token.format');const _0x17e16a=_0x32409d[0x0]+'.'+_0x32409d[0x1],_0x2b981e=DigestHelper_1[_0x2aa60a(0x94)]['digest'](Buffer[_0x2aa60a(0x8f)](_0x17e16a)),_0x1949fb=yield(_0xb08722=this['_cacheService'])===null||_0xb08722===void 0x0?void 0x0:_0xb08722[_0x2aa60a(0x98)](),_0x15e7e6=Buffer[_0x2aa60a(0x8f)](_0x32409d[0x2],_0x2aa60a(0xb7)),_0x2fb18e=_0x1949fb===null||_0x1949fb===void 0x0?void 0x0:_0x1949fb[_0x2aa60a(0xc8)],_0x169706=_0x2fb18e[_0x2aa60a(0x7c)]({'type':_0x2aa60a(0xb2),'format':_0x2aa60a(0x84)}),_0x341a33=crypto_1[_0x2aa60a(0x94)][_0x2aa60a(0x9a)](_0x2aa60a(0x79));_0x341a33[_0x2aa60a(0x7b)](_0x2b981e),_0x341a33[_0x2aa60a(0x80)]();const _0x283236=_0x341a33[_0x2aa60a(0xa0)](Buffer[_0x2aa60a(0x8f)](_0x169706),_0x15e7e6);return _0x283236;}catch(_0x3c2d9c){return console[_0x2aa60a(0xc9)](_0x3c2d9c),![];}});}static['validateJwt'](_0x358c28){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x570129=a18_0x66fb;if(yield this['validateTokenSignature'](_0x358c28)){_0x358c28[_0x570129(0xb0)]('%')&&(_0x358c28=decodeURIComponent(_0x358c28));const _0x6bf25d={'clientId':process[_0x570129(0x6d)][_0x570129(0x7d)],'accessToken':_0x358c28};try{let _0x55b125=yield this[_0x570129(0x91)](_0x6bf25d,api_1['CAMDIGIKEY_API'][_0x570129(0x9c)]);if(_0x55b125[_0x570129(0xbb)][_0x570129(0x77)])return{'is_valid':!![],'payload':_0x55b125};}catch(_0x2fa1b6){}}return{'is_valid':![],'payload':null};});}static['getOrganizationAccessToken'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4125a0=a18_0x66fb,_0x1581cc={'clientId':process[_0x4125a0(0x6d)][_0x4125a0(0x7d)],'domain':process['env'][_0x4125a0(0xb3)],'requestedDate':Date[_0x4125a0(0x8b)]()};return yield this[_0x4125a0(0x91)](_0x1581cc,api_1[_0x4125a0(0x95)][_0x4125a0(0x72)]);});}static[a18_0x881f69(0x9f)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xf2743f=a18_0x66fb,_0x391ee={'clientId':process['env'][_0xf2743f(0x7d)],'domain':process[_0xf2743f(0x6d)][_0xf2743f(0xb3)],'requestedDate':Date[_0xf2743f(0x8b)]()};return yield this[_0xf2743f(0x91)](_0x391ee,api_1[_0xf2743f(0x95)][_0xf2743f(0xaf)]);});}static['getUserAccessToken'](_0x3fe0cc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xa7b3aa=a18_0x66fb;if(!(yield this[_0xa7b3aa(0xbc)](_0x3fe0cc)))throw new InvalidTokenSignatureError_1[(_0xa7b3aa(0x94))](_0xa7b3aa(0xc0));_0x3fe0cc[_0xa7b3aa(0xb0)]('%')&&(_0x3fe0cc=decodeURIComponent(_0x3fe0cc));const _0x2f33ab={'clientId':process[_0xa7b3aa(0x6d)][_0xa7b3aa(0x7d)],'authToken':_0x3fe0cc};return yield this[_0xa7b3aa(0x91)](_0x2f33ab,api_1['CAMDIGIKEY_API'][_0xa7b3aa(0x7e)]);});}static[a18_0x881f69(0x82)](_0x3bdf4e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x152f7b=a18_0x66fb;if(!(yield this[_0x152f7b(0xbc)](_0x3bdf4e)))throw new InvalidTokenSignatureError_1[(_0x152f7b(0x94))]('Invalid\x20user\x20access\x20token\x20signature.');_0x3bdf4e['includes']('%')&&(_0x3bdf4e=decodeURIComponent(_0x3bdf4e));const _0x2575d7={'clientId':process[_0x152f7b(0x6d)][_0x152f7b(0x7d)],'accessToken':_0x3bdf4e};return yield this['requestToServer'](_0x2575d7,api_1[_0x152f7b(0x95)][_0x152f7b(0x8a)]);});}static[a18_0x881f69(0xc3)](_0x5bc795){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4bf399=a18_0x66fb;if(!(yield this[_0x4bf399(0xbc)](_0x5bc795)))throw new InvalidTokenSignatureError_1[(_0x4bf399(0x94))](_0x4bf399(0x6f));_0x5bc795[_0x4bf399(0xb0)]('%')&&(_0x5bc795=decodeURIComponent(_0x5bc795));const _0xd96728={'clientId':process[_0x4bf399(0x6d)]['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0x5bc795};return yield this[_0x4bf399(0x91)](_0xd96728,api_1[_0x4bf399(0x95)][_0x4bf399(0xa4)]);});}static[a18_0x881f69(0xca)](_0x580493,_0xa4cc02){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x307510=a18_0x66fb;if(!(yield this[_0x307510(0xbc)](_0x580493)))throw new InvalidTokenSignatureError_1[(_0x307510(0x94))](_0x307510(0x78));_0x580493[_0x307510(0xb0)]('%')&&(_0x580493=decodeURIComponent(_0x580493));const _0x5b12d5={'clientId':process[_0x307510(0x6d)][_0x307510(0x7d)],'domain':process[_0x307510(0x6d)][_0x307510(0xb3)],'accessToken':_0x580493,'personalCode':_0xa4cc02};return yield this['requestToServer'](_0x5b12d5,api_1[_0x307510(0x95)][_0x307510(0xa7)]);});}static[a18_0x881f69(0xa8)](_0x39f1bc){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1d73eb=a18_0x66fb;if(!(yield this[_0x1d73eb(0xbc)](_0x39f1bc)))throw new InvalidTokenSignatureError_1[(_0x1d73eb(0x94))](_0x1d73eb(0x78));_0x39f1bc['includes']('%')&&(_0x39f1bc=decodeURIComponent(_0x39f1bc));const _0x1bcd05={'clientId':process[_0x1d73eb(0x6d)]['CAMDIGIKEY_CLIENT_ID'],'domain':process['env'][_0x1d73eb(0xb3)],'accountToken':_0x39f1bc};return yield this[_0x1d73eb(0x91)](_0x1bcd05,api_1[_0x1d73eb(0x95)][_0x1d73eb(0x9d)]);});}static[a18_0x881f69(0x76)](_0x3ef655){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4d7a47=a18_0x66fb;if(!(yield this['validateTokenSignature'](_0x3ef655)))throw new InvalidTokenSignatureError_1[(_0x4d7a47(0x94))](_0x4d7a47(0x78));_0x3ef655[_0x4d7a47(0xb0)]('%')&&(_0x3ef655=decodeURIComponent(_0x3ef655));const _0x1ef334={'clientId':process['env'][_0x4d7a47(0x7d)],'accessToken':_0x3ef655};return yield this[_0x4d7a47(0x91)](_0x1ef334,api_1[_0x4d7a47(0x95)][_0x4d7a47(0xcc)]);});}};exports[a18_0x881f69(0xa1)]=CamDigiKeyClient;