'use strict';const a18_0x5fb74a=a18_0x22a4;(function(_0x3556a0,_0x2249be){const _0x17b085=a18_0x22a4,_0x1dbdfc=_0x3556a0();while(!![]){try{const _0x4beb1f=-parseInt(_0x17b085(0x1cd))/0x1+parseInt(_0x17b085(0x20c))/0x2+parseInt(_0x17b085(0x1f2))/0x3*(parseInt(_0x17b085(0x219))/0x4)+-parseInt(_0x17b085(0x211))/0x5*(-parseInt(_0x17b085(0x20e))/0x6)+parseInt(_0x17b085(0x21f))/0x7*(-parseInt(_0x17b085(0x217))/0x8)+-parseInt(_0x17b085(0x1dd))/0x9*(-parseInt(_0x17b085(0x1f8))/0xa)+parseInt(_0x17b085(0x200))/0xb*(parseInt(_0x17b085(0x1d3))/0xc);if(_0x4beb1f===_0x2249be)break;else _0x1dbdfc['push'](_0x1dbdfc['shift']());}catch(_0x146d37){_0x1dbdfc['push'](_0x1dbdfc['shift']());}}}(a18_0x15c7,0xc87e0));var __awaiter=this&&this[a18_0x5fb74a(0x1cb)]||function(_0x2a9af9,_0x53b713,_0xf7c85f,_0x5a4c13){function _0x26bb7e(_0x456896){return _0x456896 instanceof _0xf7c85f?_0x456896:new _0xf7c85f(function(_0x53f270){_0x53f270(_0x456896);});}return new(_0xf7c85f||(_0xf7c85f=Promise))(function(_0x347c96,_0x460924){const _0x19e0b4=a18_0x22a4;function _0x57e14e(_0x5d0ad0){const _0x5b1a54=a18_0x22a4;try{_0x4dbbe2(_0x5a4c13[_0x5b1a54(0x1ed)](_0x5d0ad0));}catch(_0x3b6c25){_0x460924(_0x3b6c25);}}function _0x427097(_0x47b563){const _0x27a16f=a18_0x22a4;try{_0x4dbbe2(_0x5a4c13[_0x27a16f(0x21b)](_0x47b563));}catch(_0x2aab3a){_0x460924(_0x2aab3a);}}function _0x4dbbe2(_0xcb3e24){const _0x5b5b7a=a18_0x22a4;_0xcb3e24[_0x5b5b7a(0x1c9)]?_0x347c96(_0xcb3e24[_0x5b5b7a(0x1e0)]):_0x26bb7e(_0xcb3e24[_0x5b5b7a(0x1e0)])[_0x5b5b7a(0x1d5)](_0x57e14e,_0x427097);}_0x4dbbe2((_0x5a4c13=_0x5a4c13['apply'](_0x2a9af9,_0x53b713||[]))[_0x19e0b4(0x1ed)]());});},__importDefault=this&&this['__importDefault']||function(_0x64d9e1){const _0x521a62=a18_0x5fb74a;return _0x64d9e1&&_0x64d9e1[_0x521a62(0x20d)]?_0x64d9e1:{'default':_0x64d9e1};};function a18_0x15c7(){const _0xa997d4=['1119llqnan','export','certBag','binary','agentOptions','Invalid\x20user\x20access\x20token\x20signature.','44930fJFmrq','split','pkcs12','createVerify','validateTokenSignature','_cacheService','status','from','11sAKPmc','pkcs12FromAsn1','getBytes','X509Certificate','publicKey','statusCode','./error/InvalidTokenSignatureError','asn1','./crypto/Wrapper','application/json','readFileSync','LOGIN_TOKEN_REQUEST_URL','2181194pTWGZh','__esModule','1144338FDCmVa','signerCertificate','CAMDIGIKEY_API','15KEcnKK','end','_trustedRootCert','length','default','oids','2075496SoFtMB','CAMDIGIKEY_CLIENT_DOMAIN','4156kuuQxv','pki','throw','digest','ORG_ACCESS_TOKEN_URL','requestToServer','7MvkojU','Error\x20requesting\x20to\x20CamDigiKey\x20Server.\x20Error:\x20','done','ACCESS_TOKEN_STATUS_URL','__awaiter','CERTIFICATE','1060293mxFJga','invalid.token.type','RETRIEVE_FACE_URL','Invalid\x20access\x20token\x20signature','getUserFace','getUserAccessToken','871932bWQMCF','request','then','env','now','./crypto/DigestHelper','getBags','logoutAccessToken','post','pem','36Vpmdjh','VERIFY_USER_PROFILE','init','value','wrapRequest','getLoginToken','string','node-forge','./api','base64','validateJwt','CAMDIGIKEY_SERVER_BASED_URL','LOGOUT_USER_ACCESS_TOKEN_URL','./error/CamDigiKeyError','data','includes','next','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','sha512','verifyAccountToken','CAMDIGIKEY_CLIENT_ID'];a18_0x15c7=function(){return _0xa997d4;};return a18_0x15c7();}Object['defineProperty'](exports,a18_0x5fb74a(0x20d),{'value':!![]}),exports['CamDigiKeyClient']=void 0x0;const Wrapper_1=__importDefault(require(a18_0x5fb74a(0x208))),CamDigiKeyError_1=__importDefault(require(a18_0x5fb74a(0x1ea))),InvalidAccessTokenTypeError_1=__importDefault(require('./error/InvalidAccessTokenTypeError')),DigestHelper_1=__importDefault(require(a18_0x5fb74a(0x1d8))),CamDigiKeyMemoryCache_1=__importDefault(require('./cache/CamDigiKeyMemoryCache')),InvalidTokenSignatureError_1=__importDefault(require(a18_0x5fb74a(0x206))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require(a18_0x5fb74a(0x1d4))),crypto_1=__importDefault(require('crypto')),node_forge_1=__importDefault(require(a18_0x5fb74a(0x1e4))),api_1=require(a18_0x5fb74a(0x1e5)),CamDigiKeyClient=class{static[a18_0x5fb74a(0x1df)](){const _0x281d37=a18_0x5fb74a,_0x3025df=fs_1[_0x281d37(0x215)][_0x281d37(0x20a)](String(process['env']['CAMDIGIKEY_CLIENT_TRUST_STORE_FILE']),_0x281d37(0x1f5)),_0x53763c=node_forge_1['default']['asn1']['fromDer'](_0x3025df),_0x4eac97=node_forge_1['default'][_0x281d37(0x1fa)][_0x281d37(0x201)](_0x53763c,String(process[_0x281d37(0x1d6)][_0x281d37(0x1ee)])),_0x5990df=_0x4eac97[_0x281d37(0x1d9)]({'bagType':node_forge_1[_0x281d37(0x215)][_0x281d37(0x21a)][_0x281d37(0x216)][_0x281d37(0x1f4)]}),_0x5ca79f=_0x5990df[node_forge_1[_0x281d37(0x215)][_0x281d37(0x21a)]['oids'][_0x281d37(0x1f4)]][0x0],_0x1dceae={'type':_0x281d37(0x1cc),'body':node_forge_1['default'][_0x281d37(0x207)]['toDer'](_0x5ca79f['asn1'])[_0x281d37(0x202)]()},_0x357ad4=node_forge_1[_0x281d37(0x215)][_0x281d37(0x1dc)]['encode'](_0x1dceae);this[_0x281d37(0x213)]=new crypto_1['default'][(_0x281d37(0x203))](_0x357ad4),this[_0x281d37(0x1fd)]=new CamDigiKeyMemoryCache_1[(_0x281d37(0x215))](this[_0x281d37(0x213)]);}static[a18_0x5fb74a(0x21e)](_0x1e6739,_0x45a8af){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x55681f=a18_0x22a4;try{const _0x3971b8=String(process[_0x55681f(0x1d6)][_0x55681f(0x1e8)])+_0x45a8af,_0x6bdae1=Wrapper_1[_0x55681f(0x215)][_0x55681f(0x1e1)](_0x1e6739),_0x569418={'url':_0x3971b8,'headers':{'Content-Type':_0x55681f(0x209)},'json':_0x6bdae1};return process['env']['CAMDIGIKEY_CLIENT_KEYSTORE_FILE']&&(_0x569418[_0x55681f(0x1f6)]={'pfx':fs_1[_0x55681f(0x215)][_0x55681f(0x20a)](String(process[_0x55681f(0x1d6)]['CAMDIGIKEY_CLIENT_KEYSTORE_FILE'])),'passphrase':String(process['env']['CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD'])}),yield new Promise((_0x5127b3,_0x34570a)=>{const _0x31988b=_0x55681f;request_1[_0x31988b(0x215)][_0x31988b(0x1db)](_0x569418,(_0x5e2eeb,_0x33bfb2,_0xb442ee)=>{const _0x19e38e=_0x31988b;if(!_0x5e2eeb&&_0x33bfb2[_0x19e38e(0x205)]>=0xc8&&_0x33bfb2[_0x19e38e(0x205)]<0x12c){if(_0xb442ee!=null)try{const _0xcd6658=Wrapper_1[_0x19e38e(0x215)]['unwrapResponse'](_0xb442ee);return _0x5127b3(_0xcd6658);}catch(_0x5a85c1){return _0x34570a(_0x5a85c1);}else return _0x5127b3({});}else return _0x34570a(new CamDigiKeyError_1['default'](_0x19e38e(0x1c8)+(_0x5e2eeb===null||_0x5e2eeb===void 0x0?void 0x0:_0x5e2eeb['message'])));});});}catch(_0xde0849){throw new CamDigiKeyError_1[(_0x55681f(0x215))](_0xde0849['message']);}});}static[a18_0x5fb74a(0x1fc)](_0x315baa){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5b6c12=a18_0x22a4;var _0x1ad440;!this[_0x5b6c12(0x1fd)]&&this[_0x5b6c12(0x1df)]();if(typeof _0x315baa!==_0x5b6c12(0x1e3))throw new InvalidAccessTokenTypeError_1[(_0x5b6c12(0x215))](_0x5b6c12(0x1ce));_0x315baa['includes']('%')&&(_0x315baa=decodeURIComponent(_0x315baa));try{const _0x4d6f4c=_0x315baa[_0x5b6c12(0x1f9)]('.');if(_0x4d6f4c[_0x5b6c12(0x214)]!==0x3)throw new InvalidAccessTokenTypeError_1[(_0x5b6c12(0x215))]('invalid.token.format');const _0x181853=_0x4d6f4c[0x0]+'.'+_0x4d6f4c[0x1],_0x187480=DigestHelper_1[_0x5b6c12(0x215)][_0x5b6c12(0x21c)](Buffer[_0x5b6c12(0x1ff)](_0x181853)),_0x1636f3=yield(_0x1ad440=this[_0x5b6c12(0x1fd)])===null||_0x1ad440===void 0x0?void 0x0:_0x1ad440[_0x5b6c12(0x20f)](),_0x450313=Buffer[_0x5b6c12(0x1ff)](_0x4d6f4c[0x2],_0x5b6c12(0x1e6)),_0x56855b=_0x1636f3===null||_0x1636f3===void 0x0?void 0x0:_0x1636f3[_0x5b6c12(0x204)],_0x34b066=_0x56855b[_0x5b6c12(0x1f3)]({'type':'spki','format':_0x5b6c12(0x1dc)}),_0x2f906c=crypto_1[_0x5b6c12(0x215)][_0x5b6c12(0x1fb)](_0x5b6c12(0x1ef));_0x2f906c['write'](_0x187480),_0x2f906c[_0x5b6c12(0x212)]();const _0xf8b6bf=_0x2f906c['verify'](Buffer[_0x5b6c12(0x1ff)](_0x34b066),_0x450313);return _0xf8b6bf;}catch(_0x547c6b){return console['error'](_0x547c6b),![];}});}static[a18_0x5fb74a(0x1e7)](_0x57475b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1522b8=a18_0x22a4;if(yield this[_0x1522b8(0x1fc)](_0x57475b)){_0x57475b['includes']('%')&&(_0x57475b=decodeURIComponent(_0x57475b));const _0x468867={'clientId':process[_0x1522b8(0x1d6)][_0x1522b8(0x1f1)],'accessToken':_0x57475b};try{let _0x13d523=yield this[_0x1522b8(0x21e)](_0x468867,api_1[_0x1522b8(0x210)][_0x1522b8(0x1ca)]);if(_0x13d523[_0x1522b8(0x1eb)][_0x1522b8(0x1fe)])return{'is_valid':!![],'payload':_0x13d523};}catch(_0x2ce10a){}}return{'is_valid':![],'payload':null};});}static['getOrganizationAccessToken'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x160d0b=a18_0x22a4,_0x21213f={'clientId':process[_0x160d0b(0x1d6)]['CAMDIGIKEY_CLIENT_ID'],'domain':process[_0x160d0b(0x1d6)]['CAMDIGIKEY_CLIENT_DOMAIN'],'requestedDate':Date[_0x160d0b(0x1d7)]()};return yield this[_0x160d0b(0x21e)](_0x21213f,api_1[_0x160d0b(0x210)][_0x160d0b(0x21d)]);});}static[a18_0x5fb74a(0x1e2)](_0x29f672){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5b4edc=a18_0x22a4,_0x4624f1={'clientId':process[_0x5b4edc(0x1d6)][_0x5b4edc(0x1f1)],'domain':process[_0x5b4edc(0x1d6)][_0x5b4edc(0x218)],'requestedDate':Date[_0x5b4edc(0x1d7)](),'callbackVars':_0x29f672!==null&&_0x29f672!==void 0x0?_0x29f672:null};return yield this[_0x5b4edc(0x21e)](_0x4624f1,api_1[_0x5b4edc(0x210)][_0x5b4edc(0x20b)]);});}static[a18_0x5fb74a(0x1d2)](_0x543ad9){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4e7d45=a18_0x22a4;if(!(yield this[_0x4e7d45(0x1fc)](_0x543ad9)))throw new InvalidTokenSignatureError_1[(_0x4e7d45(0x215))]('Invalid\x20auth\x20token\x20signature.');_0x543ad9['includes']('%')&&(_0x543ad9=decodeURIComponent(_0x543ad9));const _0x4efdcc={'clientId':process['env'][_0x4e7d45(0x1f1)],'authToken':_0x543ad9};return yield this[_0x4e7d45(0x21e)](_0x4efdcc,api_1[_0x4e7d45(0x210)]['ACCESS_TOKEN_REQUEST_URL']);});}static['refreshUserAccessToken'](_0x32b1d5){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x446c8d=a18_0x22a4;if(!(yield this[_0x446c8d(0x1fc)](_0x32b1d5)))throw new InvalidTokenSignatureError_1['default'](_0x446c8d(0x1f7));_0x32b1d5['includes']('%')&&(_0x32b1d5=decodeURIComponent(_0x32b1d5));const _0x5874e5={'clientId':process[_0x446c8d(0x1d6)]['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0x32b1d5};return yield this['requestToServer'](_0x5874e5,api_1['CAMDIGIKEY_API']['ACCESS_TOKEN_REFRESH_URL']);});}static[a18_0x5fb74a(0x1da)](_0x2d1ff8){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x788259=a18_0x22a4;if(!(yield this[_0x788259(0x1fc)](_0x2d1ff8)))throw new InvalidTokenSignatureError_1[(_0x788259(0x215))]('Invalid\x20user\x20access\x20token\x20signature.');_0x2d1ff8[_0x788259(0x1ec)]('%')&&(_0x2d1ff8=decodeURIComponent(_0x2d1ff8));const _0x575bae={'clientId':process['env'][_0x788259(0x1f1)],'accessToken':_0x2d1ff8};return yield this[_0x788259(0x21e)](_0x575bae,api_1['CAMDIGIKEY_API'][_0x788259(0x1e9)]);});}static['lookupUserProfile'](_0x2ec5e0,_0x173100){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1d7908=a18_0x22a4;if(!(yield this[_0x1d7908(0x1fc)](_0x2ec5e0)))throw new InvalidTokenSignatureError_1[(_0x1d7908(0x215))](_0x1d7908(0x1d0));_0x2ec5e0[_0x1d7908(0x1ec)]('%')&&(_0x2ec5e0=decodeURIComponent(_0x2ec5e0));const _0x15c5b5={'clientId':process[_0x1d7908(0x1d6)][_0x1d7908(0x1f1)],'domain':process[_0x1d7908(0x1d6)][_0x1d7908(0x218)],'accessToken':_0x2ec5e0,'personalCode':_0x173100};return yield this[_0x1d7908(0x21e)](_0x15c5b5,api_1[_0x1d7908(0x210)]['LOOKUP_USER_PROFILE']);});}static[a18_0x5fb74a(0x1f0)](_0x20cc07){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x24db6b=a18_0x22a4;if(!(yield this[_0x24db6b(0x1fc)](_0x20cc07)))throw new InvalidTokenSignatureError_1[(_0x24db6b(0x215))](_0x24db6b(0x1d0));_0x20cc07[_0x24db6b(0x1ec)]('%')&&(_0x20cc07=decodeURIComponent(_0x20cc07));const _0x2d65b0={'clientId':process[_0x24db6b(0x1d6)][_0x24db6b(0x1f1)],'domain':process[_0x24db6b(0x1d6)][_0x24db6b(0x218)],'accountToken':_0x20cc07};return yield this[_0x24db6b(0x21e)](_0x2d65b0,api_1['CAMDIGIKEY_API'][_0x24db6b(0x1de)]);});}static[a18_0x5fb74a(0x1d1)](_0x2ac21b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xd1bcce=a18_0x22a4;if(!(yield this[_0xd1bcce(0x1fc)](_0x2ac21b)))throw new InvalidTokenSignatureError_1[(_0xd1bcce(0x215))](_0xd1bcce(0x1d0));_0x2ac21b[_0xd1bcce(0x1ec)]('%')&&(_0x2ac21b=decodeURIComponent(_0x2ac21b));const _0x1c6011={'clientId':process[_0xd1bcce(0x1d6)][_0xd1bcce(0x1f1)],'accessToken':_0x2ac21b};return yield this[_0xd1bcce(0x21e)](_0x1c6011,api_1['CAMDIGIKEY_API'][_0xd1bcce(0x1cf)]);});}};function a18_0x22a4(_0xb85897,_0x139a19){const _0x15c7ae=a18_0x15c7();return a18_0x22a4=function(_0x22a44f,_0x101d5e){_0x22a44f=_0x22a44f-0x1c8;let _0x36efbc=_0x15c7ae[_0x22a44f];return _0x36efbc;},a18_0x22a4(_0xb85897,_0x139a19);}exports['CamDigiKeyClient']=CamDigiKeyClient;