'use strict';const a18_0x359205=a18_0x31b3;function a18_0x31b3(_0x12def2,_0x42ac0c){const _0x5e1a1d=a18_0x5e1a();return a18_0x31b3=function(_0x31b305,_0xe748b9){_0x31b305=_0x31b305-0x6a;let _0x48a49e=_0x5e1a1d[_0x31b305];return _0x48a49e;},a18_0x31b3(_0x12def2,_0x42ac0c);}(function(_0x5e77c3,_0x1937f4){const _0x11059e=a18_0x31b3,_0x2559e0=_0x5e77c3();while(!![]){try{const _0xcc0dec=-parseInt(_0x11059e(0xaf))/0x1+parseInt(_0x11059e(0xa6))/0x2+parseInt(_0x11059e(0xbb))/0x3*(parseInt(_0x11059e(0xc4))/0x4)+-parseInt(_0x11059e(0xc5))/0x5*(-parseInt(_0x11059e(0x83))/0x6)+parseInt(_0x11059e(0x74))/0x7*(parseInt(_0x11059e(0x9d))/0x8)+parseInt(_0x11059e(0x6c))/0x9+-parseInt(_0x11059e(0x95))/0xa;if(_0xcc0dec===_0x1937f4)break;else _0x2559e0['push'](_0x2559e0['shift']());}catch(_0x39a0ba){_0x2559e0['push'](_0x2559e0['shift']());}}}(a18_0x5e1a,0xe67f8));function a18_0x5e1a(){const _0x5a5783=['Invalid\x20user\x20access\x20token\x20signature.','CAMDIGIKEY_API','pkcs12','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','19918510pKkCsR','export','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','crypto','RETRIEVE_FACE_URL','throw','spki','error','54392FNQOnm','oids','publicKey','requestToServer','createVerify','split','_cacheService','asn1','ACCESS_TOKEN_REFRESH_URL','1485294PwgOuA','node-forge','LOGOUT_USER_ACCESS_TOKEN_URL','init','CAMDIGIKEY_CLIENT_ID','refreshUserAccessToken','getBags','lookupUserProfile','pkcs12FromAsn1','1322427sbMxCj','getOrganizationAccessToken','then','Invalid\x20access\x20token\x20signature','agentOptions','readFileSync','validateJwt','defineProperty','statusCode','validateTokenSignature','pem','digest','3701073reZNbF','LOGIN_TOKEN_REQUEST_URL','./error/InvalidTokenSignatureError','VERIFY_USER_PROFILE','next','__esModule','application/json','pki','./crypto/DigestHelper','4LMLqNj','3688705mLIwAo','Invalid\x20auth\x20token\x20signature.','encode','X509Certificate','3068064ZwzxMk','env','base64','CAMDIGIKEY_CLIENT_DOMAIN','fromDer','Error\x20requesting\x20to\x20CamDigiKey\x20Server.\x20Error:\x20','toDer','__awaiter','1239MmPZVC','LOOKUP_USER_PROFILE','from','CamDigiKeyClient','string','apply','_trustedRootCert','verifyAccountToken','status','./crypto/Wrapper','certBag','verify','includes','now','data','6PWXRKj','binary','getUserAccessToken','CAMDIGIKEY_SERVER_BASED_URL','end','default','message','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','./error/InvalidAccessTokenTypeError','CERTIFICATE','unwrapResponse','getLoginToken','wrapRequest','sha512'];a18_0x5e1a=function(){return _0x5a5783;};return a18_0x5e1a();}var __awaiter=this&&this[a18_0x359205(0x73)]||function(_0x242bb1,_0x2b2fa8,_0x1032d4,_0x3118e9){function _0x45db74(_0x46c0a5){return _0x46c0a5 instanceof _0x1032d4?_0x46c0a5:new _0x1032d4(function(_0x5cf492){_0x5cf492(_0x46c0a5);});}return new(_0x1032d4||(_0x1032d4=Promise))(function(_0x594c87,_0x3f50f0){const _0x284ecd=a18_0x31b3;function _0x449a8a(_0x2a78b8){try{_0x5d3674(_0x3118e9['next'](_0x2a78b8));}catch(_0xacd8d){_0x3f50f0(_0xacd8d);}}function _0x205835(_0x446258){const _0x2395eb=a18_0x31b3;try{_0x5d3674(_0x3118e9[_0x2395eb(0x9a)](_0x446258));}catch(_0x57986d){_0x3f50f0(_0x57986d);}}function _0x5d3674(_0x475287){const _0x16131b=a18_0x31b3;_0x475287['done']?_0x594c87(_0x475287['value']):_0x45db74(_0x475287['value'])[_0x16131b(0xb1)](_0x449a8a,_0x205835);}_0x5d3674((_0x3118e9=_0x3118e9[_0x284ecd(0x79)](_0x242bb1,_0x2b2fa8||[]))[_0x284ecd(0xbf)]());});},__importDefault=this&&this['__importDefault']||function(_0x1eaa6f){const _0x4ef1fa=a18_0x359205;return _0x1eaa6f&&_0x1eaa6f[_0x4ef1fa(0xc0)]?_0x1eaa6f:{'default':_0x1eaa6f};};Object[a18_0x359205(0xb6)](exports,a18_0x359205(0xc0),{'value':!![]}),exports[a18_0x359205(0x77)]=void 0x0;const Wrapper_1=__importDefault(require(a18_0x359205(0x7d))),CamDigiKeyError_1=__importDefault(require('./error/CamDigiKeyError')),InvalidAccessTokenTypeError_1=__importDefault(require(a18_0x359205(0x8b))),DigestHelper_1=__importDefault(require(a18_0x359205(0xc3))),CamDigiKeyMemoryCache_1=__importDefault(require('./cache/CamDigiKeyMemoryCache')),InvalidTokenSignatureError_1=__importDefault(require(a18_0x359205(0xbd))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require('request')),crypto_1=__importDefault(require(a18_0x359205(0x98))),node_forge_1=__importDefault(require(a18_0x359205(0xa7))),api_1=require('./api'),CamDigiKeyClient=class{static[a18_0x359205(0xa9)](){const _0x26babd=a18_0x359205,_0x4290c1=fs_1[_0x26babd(0x88)][_0x26babd(0xb4)](String(process['env']['CAMDIGIKEY_CLIENT_TRUST_STORE_FILE']),_0x26babd(0x84)),_0xc63ef1=node_forge_1[_0x26babd(0x88)][_0x26babd(0xa4)][_0x26babd(0x70)](_0x4290c1),_0x55a1b9=node_forge_1[_0x26babd(0x88)][_0x26babd(0x93)][_0x26babd(0xae)](_0xc63ef1,String(process[_0x26babd(0x6d)][_0x26babd(0x97)])),_0x2d2bd5=_0x55a1b9[_0x26babd(0xac)]({'bagType':node_forge_1[_0x26babd(0x88)]['pki']['oids'][_0x26babd(0x7e)]}),_0x3986d4=_0x2d2bd5[node_forge_1['default'][_0x26babd(0xc2)][_0x26babd(0x9e)][_0x26babd(0x7e)]][0x0],_0x21d6d8={'type':_0x26babd(0x8c),'body':node_forge_1[_0x26babd(0x88)][_0x26babd(0xa4)][_0x26babd(0x72)](_0x3986d4[_0x26babd(0xa4)])['getBytes']()},_0x3dcf9b=node_forge_1['default'][_0x26babd(0xb9)][_0x26babd(0x6a)](_0x21d6d8);this['_trustedRootCert']=new crypto_1['default'][(_0x26babd(0x6b))](_0x3dcf9b),this[_0x26babd(0xa3)]=new CamDigiKeyMemoryCache_1['default'](this[_0x26babd(0x7a)]);}static[a18_0x359205(0xa0)](_0x4bae12,_0x5201d7){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x165672=a18_0x31b3;try{const _0xa20cd5=String(process[_0x165672(0x6d)][_0x165672(0x86)])+_0x5201d7,_0x37dec3=Wrapper_1[_0x165672(0x88)][_0x165672(0x8f)](_0x4bae12),_0x5ea79e={'url':_0xa20cd5,'headers':{'Content-Type':_0x165672(0xc1)},'json':_0x37dec3};return process[_0x165672(0x6d)][_0x165672(0x8a)]&&(_0x5ea79e[_0x165672(0xb3)]={'pfx':fs_1[_0x165672(0x88)][_0x165672(0xb4)](String(process[_0x165672(0x6d)][_0x165672(0x8a)])),'passphrase':String(process[_0x165672(0x6d)][_0x165672(0x94)])}),yield new Promise(_0x54ca76=>{request_1['default']['post'](_0x5ea79e,(_0x1ac29f,_0x50031c,_0x4441dc)=>{const _0x4242d5=a18_0x31b3;if(!_0x1ac29f&&_0x50031c[_0x4242d5(0xb7)]>=0xc8&&_0x50031c[_0x4242d5(0xb7)]<0x12c){if(_0x4441dc!=null){const _0x44c42c=Wrapper_1[_0x4242d5(0x88)][_0x4242d5(0x8d)](_0x4441dc);return _0x54ca76(_0x44c42c);}else return _0x54ca76({});}else throw new CamDigiKeyError_1['default'](_0x4242d5(0x71)+(_0x1ac29f===null||_0x1ac29f===void 0x0?void 0x0:_0x1ac29f[_0x4242d5(0x89)]));});});}catch(_0x5c61b2){throw new CamDigiKeyError_1[(_0x165672(0x88))](_0x5c61b2['message']);}});}static[a18_0x359205(0xb8)](_0x2916e9){var _0x5a6dfd;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3219ef=a18_0x31b3;!this[_0x3219ef(0xa3)]&&this[_0x3219ef(0xa9)]();if(typeof _0x2916e9!==_0x3219ef(0x78))throw new InvalidAccessTokenTypeError_1[(_0x3219ef(0x88))]('invalid.token.type');_0x2916e9[_0x3219ef(0x80)]('%')&&(_0x2916e9=decodeURIComponent(_0x2916e9));try{const _0x58c0f4=_0x2916e9[_0x3219ef(0xa2)]('.');if(_0x58c0f4['length']!==0x3)throw new InvalidAccessTokenTypeError_1['default']('invalid.token.format');const _0xe3749a=_0x58c0f4[0x0]+'.'+_0x58c0f4[0x1],_0x74e67=DigestHelper_1['default'][_0x3219ef(0xba)](Buffer[_0x3219ef(0x76)](_0xe3749a)),_0x6ad1df=yield(_0x5a6dfd=this['_cacheService'])===null||_0x5a6dfd===void 0x0?void 0x0:_0x5a6dfd['signerCertificate'](),_0x16a543=Buffer['from'](_0x58c0f4[0x2],_0x3219ef(0x6e)),_0x4544ff=_0x6ad1df===null||_0x6ad1df===void 0x0?void 0x0:_0x6ad1df[_0x3219ef(0x9f)],_0x14676c=_0x4544ff[_0x3219ef(0x96)]({'type':_0x3219ef(0x9b),'format':_0x3219ef(0xb9)}),_0x55f347=crypto_1[_0x3219ef(0x88)][_0x3219ef(0xa1)](_0x3219ef(0x90));_0x55f347['write'](_0x74e67),_0x55f347[_0x3219ef(0x87)]();const _0x3b2d01=_0x55f347[_0x3219ef(0x7f)](Buffer[_0x3219ef(0x76)](_0x14676c),_0x16a543);return _0x3b2d01;}catch(_0x4b88a4){return console[_0x3219ef(0x9c)](_0x4b88a4),![];}});}static[a18_0x359205(0xb5)](_0x4cf001){return __awaiter(this,void 0x0,void 0x0,function*(){const _0xef2026=a18_0x31b3;if(yield this[_0xef2026(0xb8)](_0x4cf001)){_0x4cf001[_0xef2026(0x80)]('%')&&(_0x4cf001=decodeURIComponent(_0x4cf001));const _0x5947e0={'clientId':process['env'][_0xef2026(0xaa)],'accessToken':_0x4cf001};try{let _0x2d0a91=yield this[_0xef2026(0xa0)](_0x5947e0,api_1['CAMDIGIKEY_API']['ACCESS_TOKEN_STATUS_URL']);if(_0x2d0a91[_0xef2026(0x82)][_0xef2026(0x7c)])return{'is_valid':!![],'payload':_0x2d0a91};}catch(_0x264172){}}return{'is_valid':![],'payload':null};});}static[a18_0x359205(0xb0)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3f11b1=a18_0x31b3,_0x2a2c27={'clientId':process[_0x3f11b1(0x6d)][_0x3f11b1(0xaa)],'domain':process[_0x3f11b1(0x6d)][_0x3f11b1(0x6f)],'requestedDate':Date[_0x3f11b1(0x81)]()};return yield this[_0x3f11b1(0xa0)](_0x2a2c27,api_1['CAMDIGIKEY_API']['ORG_ACCESS_TOKEN_URL']);});}static[a18_0x359205(0x8e)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1e2507=a18_0x31b3,_0x3bc8d0={'clientId':process['env'][_0x1e2507(0xaa)],'domain':process['env'][_0x1e2507(0x6f)],'requestedDate':Date['now']()};return yield this[_0x1e2507(0xa0)](_0x3bc8d0,api_1[_0x1e2507(0x92)][_0x1e2507(0xbc)]);});}static[a18_0x359205(0x85)](_0x3ba630){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1babd3=a18_0x31b3;if(!(yield this[_0x1babd3(0xb8)](_0x3ba630)))throw new InvalidTokenSignatureError_1[(_0x1babd3(0x88))](_0x1babd3(0xc6));_0x3ba630[_0x1babd3(0x80)]('%')&&(_0x3ba630=decodeURIComponent(_0x3ba630));const _0x52a67f={'clientId':process['env'][_0x1babd3(0xaa)],'authToken':_0x3ba630};return yield this[_0x1babd3(0xa0)](_0x52a67f,api_1[_0x1babd3(0x92)]['ACCESS_TOKEN_REQUEST_URL']);});}static[a18_0x359205(0xab)](_0x11c1ee){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5dddc9=a18_0x31b3;if(!(yield this['validateTokenSignature'](_0x11c1ee)))throw new InvalidTokenSignatureError_1[(_0x5dddc9(0x88))](_0x5dddc9(0x91));_0x11c1ee['includes']('%')&&(_0x11c1ee=decodeURIComponent(_0x11c1ee));const _0x5f42fa={'clientId':process[_0x5dddc9(0x6d)][_0x5dddc9(0xaa)],'accessToken':_0x11c1ee};return yield this[_0x5dddc9(0xa0)](_0x5f42fa,api_1['CAMDIGIKEY_API'][_0x5dddc9(0xa5)]);});}static['logoutAccessToken'](_0xd9ab4e){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x55e9dc=a18_0x31b3;if(!(yield this[_0x55e9dc(0xb8)](_0xd9ab4e)))throw new InvalidTokenSignatureError_1[(_0x55e9dc(0x88))](_0x55e9dc(0x91));_0xd9ab4e[_0x55e9dc(0x80)]('%')&&(_0xd9ab4e=decodeURIComponent(_0xd9ab4e));const _0x2a2f20={'clientId':process[_0x55e9dc(0x6d)][_0x55e9dc(0xaa)],'accessToken':_0xd9ab4e};return yield this[_0x55e9dc(0xa0)](_0x2a2f20,api_1['CAMDIGIKEY_API'][_0x55e9dc(0xa8)]);});}static[a18_0x359205(0xad)](_0x365646,_0x4f7c44){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3ac024=a18_0x31b3;if(!(yield this[_0x3ac024(0xb8)](_0x365646)))throw new InvalidTokenSignatureError_1[(_0x3ac024(0x88))]('Invalid\x20access\x20token\x20signature');_0x365646['includes']('%')&&(_0x365646=decodeURIComponent(_0x365646));const _0x3b1cb0={'clientId':process[_0x3ac024(0x6d)]['CAMDIGIKEY_CLIENT_ID'],'domain':process['env'][_0x3ac024(0x6f)],'accessToken':_0x365646,'personalCode':_0x4f7c44};return yield this[_0x3ac024(0xa0)](_0x3b1cb0,api_1[_0x3ac024(0x92)][_0x3ac024(0x75)]);});}static[a18_0x359205(0x7b)](_0x1befb5){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5c94d4=a18_0x31b3;if(!(yield this['validateTokenSignature'](_0x1befb5)))throw new InvalidTokenSignatureError_1[(_0x5c94d4(0x88))](_0x5c94d4(0xb2));_0x1befb5['includes']('%')&&(_0x1befb5=decodeURIComponent(_0x1befb5));const _0xfffbf9={'clientId':process[_0x5c94d4(0x6d)]['CAMDIGIKEY_CLIENT_ID'],'domain':process[_0x5c94d4(0x6d)]['CAMDIGIKEY_CLIENT_DOMAIN'],'accountToken':_0x1befb5};return yield this['requestToServer'](_0xfffbf9,api_1['CAMDIGIKEY_API'][_0x5c94d4(0xbe)]);});}static['getUserFace'](_0x5591bd){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x160249=a18_0x31b3;if(!(yield this[_0x160249(0xb8)](_0x5591bd)))throw new InvalidTokenSignatureError_1['default'](_0x160249(0xb2));_0x5591bd[_0x160249(0x80)]('%')&&(_0x5591bd=decodeURIComponent(_0x5591bd));const _0x127caa={'clientId':process[_0x160249(0x6d)]['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0x5591bd};return yield this[_0x160249(0xa0)](_0x127caa,api_1[_0x160249(0x92)][_0x160249(0x99)]);});}};exports[a18_0x359205(0x77)]=CamDigiKeyClient;