'use strict';const a18_0x145dcf=a18_0x22a1;(function(_0x152891,_0x53937c){const _0x4426e4=a18_0x22a1,_0x41ec9f=_0x152891();while(!![]){try{const _0x51f229=-parseInt(_0x4426e4(0x16f))/0x1*(parseInt(_0x4426e4(0x190))/0x2)+parseInt(_0x4426e4(0x167))/0x3+-parseInt(_0x4426e4(0x145))/0x4+parseInt(_0x4426e4(0x12d))/0x5*(parseInt(_0x4426e4(0x17e))/0x6)+-parseInt(_0x4426e4(0x14f))/0x7*(parseInt(_0x4426e4(0x166))/0x8)+-parseInt(_0x4426e4(0x14b))/0x9+-parseInt(_0x4426e4(0x16b))/0xa*(-parseInt(_0x4426e4(0x140))/0xb);if(_0x51f229===_0x53937c)break;else _0x41ec9f['push'](_0x41ec9f['shift']());}catch(_0x2c8fed){_0x41ec9f['push'](_0x41ec9f['shift']());}}}(a18_0x3b00,0x6685d));var __awaiter=this&&this[a18_0x145dcf(0x17d)]||function(_0x586ab2,_0x3d0598,_0x2c9850,_0x55d86f){function _0x12f328(_0x2b6e16){return _0x2b6e16 instanceof _0x2c9850?_0x2b6e16:new _0x2c9850(function(_0x37ecbf){_0x37ecbf(_0x2b6e16);});}return new(_0x2c9850||(_0x2c9850=Promise))(function(_0x429dc7,_0x1d9601){const _0x50d012=a18_0x22a1;function _0x364fd3(_0x4bab8d){try{_0x170d48(_0x55d86f['next'](_0x4bab8d));}catch(_0x4e9b88){_0x1d9601(_0x4e9b88);}}function _0x2e9f39(_0x169758){const _0x336672=a18_0x22a1;try{_0x170d48(_0x55d86f[_0x336672(0x171)](_0x169758));}catch(_0x5e2de6){_0x1d9601(_0x5e2de6);}}function _0x170d48(_0x291cd6){const _0x5971e5=a18_0x22a1;_0x291cd6[_0x5971e5(0x15e)]?_0x429dc7(_0x291cd6[_0x5971e5(0x16d)]):_0x12f328(_0x291cd6[_0x5971e5(0x16d)])[_0x5971e5(0x13e)](_0x364fd3,_0x2e9f39);}_0x170d48((_0x55d86f=_0x55d86f[_0x50d012(0x187)](_0x586ab2,_0x3d0598||[]))[_0x50d012(0x179)]());});},__importDefault=this&&this[a18_0x145dcf(0x164)]||function(_0x1cdd76){const _0x3a321e=a18_0x145dcf;return _0x1cdd76&&_0x1cdd76[_0x3a321e(0x155)]?_0x1cdd76:{'default':_0x1cdd76};};Object[a18_0x145dcf(0x13a)](exports,'__esModule',{'value':!![]}),exports[a18_0x145dcf(0x17f)]=void 0x0;const Wrapper_1=__importDefault(require('./crypto/Wrapper')),CamDigiKeyError_1=__importDefault(require(a18_0x145dcf(0x18e))),InvalidAccessTokenTypeError_1=__importDefault(require(a18_0x145dcf(0x158))),DigestHelper_1=__importDefault(require(a18_0x145dcf(0x18b))),CamDigiKeyMemoryCache_1=__importDefault(require(a18_0x145dcf(0x174))),InvalidTokenSignatureError_1=__importDefault(require(a18_0x145dcf(0x16e))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require(a18_0x145dcf(0x15a))),crypto_1=__importDefault(require('crypto')),node_forge_1=__importDefault(require(a18_0x145dcf(0x147))),api_1=require(a18_0x145dcf(0x18d)),CamDigiKeyClient=class{static[a18_0x145dcf(0x154)](){const _0x1549ae=a18_0x145dcf,_0x5c355f=fs_1[_0x1549ae(0x135)]['readFileSync'](String(process['env'][_0x1549ae(0x173)]),_0x1549ae(0x15b)),_0x51dffb=node_forge_1[_0x1549ae(0x135)][_0x1549ae(0x182)][_0x1549ae(0x168)](_0x5c355f),_0x5f45cf=node_forge_1[_0x1549ae(0x135)]['pkcs12']['pkcs12FromAsn1'](_0x51dffb,String(process[_0x1549ae(0x188)][_0x1549ae(0x189)])),_0x864a11=_0x5f45cf[_0x1549ae(0x176)]({'bagType':node_forge_1['default'][_0x1549ae(0x13f)][_0x1549ae(0x137)][_0x1549ae(0x15f)]}),_0x1c6d73=_0x864a11[node_forge_1['default'][_0x1549ae(0x13f)][_0x1549ae(0x137)][_0x1549ae(0x15f)]][0x0],_0x3fa2f6={'type':_0x1549ae(0x16a),'body':node_forge_1[_0x1549ae(0x135)][_0x1549ae(0x182)][_0x1549ae(0x130)](_0x1c6d73[_0x1549ae(0x182)])[_0x1549ae(0x177)]()},_0x31d19c=node_forge_1[_0x1549ae(0x135)][_0x1549ae(0x165)]['encode'](_0x3fa2f6);this['_trustedRootCert']=new crypto_1[(_0x1549ae(0x135))][(_0x1549ae(0x133))](_0x31d19c),this[_0x1549ae(0x131)]=new CamDigiKeyMemoryCache_1['default'](this[_0x1549ae(0x15d)]);}static['requestToServer'](_0x5b71ec,_0x1ebde2){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1616e7=a18_0x22a1;try{const _0x2afddf=String(process[_0x1616e7(0x188)][_0x1616e7(0x132)])+_0x1ebde2,_0x54ae3b=Wrapper_1[_0x1616e7(0x135)][_0x1616e7(0x183)](_0x5b71ec),_0x470cb2={'url':_0x2afddf,'headers':{'Content-Type':_0x1616e7(0x12f)},'json':_0x54ae3b};return process['env']['CAMDIGIKEY_CLIENT_KEYSTORE_FILE']&&(_0x470cb2[_0x1616e7(0x169)]={'pfx':fs_1['default'][_0x1616e7(0x139)](String(process[_0x1616e7(0x188)][_0x1616e7(0x146)])),'passphrase':String(process['env']['CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD'])}),yield new Promise(_0x29331a=>{const _0x4ff014=_0x1616e7;request_1['default'][_0x4ff014(0x138)](_0x470cb2,(_0x16b473,_0x3f0d59,_0x32045c)=>{const _0x45bffe=_0x4ff014;if(!_0x16b473){if(_0x3f0d59[_0x45bffe(0x152)]>=0xc8&&_0x3f0d59[_0x45bffe(0x152)]<0x12c){if(_0x32045c!=null)try{const _0x4088f7=Wrapper_1['default'][_0x45bffe(0x163)](_0x32045c);return _0x29331a(_0x4088f7);}catch(_0x48b31c){throw _0x48b31c;}else return _0x29331a({});}throw new CamDigiKeyError_1['default']('Error\x20requesting\x20to\x20CamDigiKey\x20Server.');}else throw new CamDigiKeyError_1[(_0x45bffe(0x135))](_0x16b473[_0x45bffe(0x175)]);});});}catch(_0x456856){throw new CamDigiKeyError_1[(_0x1616e7(0x135))](_0x456856[_0x1616e7(0x175)]);}});}static[a18_0x145dcf(0x14c)](_0x18a2a2){var _0x475450;return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4242f9=a18_0x22a1;!this[_0x4242f9(0x131)]&&this['init']();if(typeof _0x18a2a2!==_0x4242f9(0x186))throw new InvalidAccessTokenTypeError_1['default']('invalid.token.type');_0x18a2a2['includes']('%')&&(_0x18a2a2=decodeURIComponent(_0x18a2a2));try{const _0x322665=_0x18a2a2[_0x4242f9(0x153)]('.');if(_0x322665['length']!==0x3)throw new InvalidAccessTokenTypeError_1[(_0x4242f9(0x135))](_0x4242f9(0x12e));const _0x3a3d2e=_0x322665[0x0]+'.'+_0x322665[0x1],_0x152d24=DigestHelper_1['default'][_0x4242f9(0x172)](Buffer['from'](_0x3a3d2e)),_0x20bb03=yield(_0x475450=this[_0x4242f9(0x131)])===null||_0x475450===void 0x0?void 0x0:_0x475450[_0x4242f9(0x17b)](),_0x3ae9a3=Buffer['from'](_0x322665[0x2],_0x4242f9(0x18f)),_0xc39143=_0x20bb03===null||_0x20bb03===void 0x0?void 0x0:_0x20bb03[_0x4242f9(0x157)],_0x5080a0=_0xc39143[_0x4242f9(0x136)]({'type':_0x4242f9(0x160),'format':_0x4242f9(0x165)}),_0x13ef6f=crypto_1[_0x4242f9(0x135)][_0x4242f9(0x134)](_0x4242f9(0x143));_0x13ef6f['write'](_0x152d24),_0x13ef6f[_0x4242f9(0x144)]();const _0x5493eb=_0x13ef6f[_0x4242f9(0x142)](Buffer[_0x4242f9(0x18a)](_0x5080a0),_0x3ae9a3);return _0x5493eb;}catch(_0x24b402){return console[_0x4242f9(0x14d)](_0x24b402),![];}});}static[a18_0x145dcf(0x170)](_0x59d9ac){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3fdb87=a18_0x22a1;if(yield this['validateTokenSignature'](_0x59d9ac)){_0x59d9ac[_0x3fdb87(0x14a)]('%')&&(_0x59d9ac=decodeURIComponent(_0x59d9ac));const _0x27e9de={'clientId':process[_0x3fdb87(0x188)][_0x3fdb87(0x162)],'accessToken':_0x59d9ac};try{let _0x49b976=yield this[_0x3fdb87(0x180)](_0x27e9de,api_1[_0x3fdb87(0x17c)][_0x3fdb87(0x16c)]);if(_0x49b976[_0x3fdb87(0x14e)][_0x3fdb87(0x17a)])return{'is_valid':!![],'payload':_0x49b976};}catch(_0x211562){}}return{'is_valid':![],'payload':null};});}static[a18_0x145dcf(0x151)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5e51ec=a18_0x22a1,_0x3808ca={'clientId':process[_0x5e51ec(0x188)][_0x5e51ec(0x162)],'domain':process[_0x5e51ec(0x188)][_0x5e51ec(0x13b)],'requestedDate':Date[_0x5e51ec(0x18c)]()};return yield this[_0x5e51ec(0x180)](_0x3808ca,api_1['CAMDIGIKEY_API'][_0x5e51ec(0x185)]);});}static[a18_0x145dcf(0x15c)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5dfd76=a18_0x22a1,_0x578c5b={'clientId':process[_0x5dfd76(0x188)]['CAMDIGIKEY_CLIENT_ID'],'domain':process[_0x5dfd76(0x188)][_0x5dfd76(0x13b)],'requestedDate':Date[_0x5dfd76(0x18c)]()};return yield this['requestToServer'](_0x578c5b,api_1[_0x5dfd76(0x17c)][_0x5dfd76(0x141)]);});}static[a18_0x145dcf(0x149)](_0x536b66){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4da347=a18_0x22a1;if(!(yield this['validateTokenSignature'](_0x536b66)))throw new InvalidTokenSignatureError_1[(_0x4da347(0x135))](_0x4da347(0x156));_0x536b66['includes']('%')&&(_0x536b66=decodeURIComponent(_0x536b66));const _0x334e7d={'clientId':process['env'][_0x4da347(0x162)],'authToken':_0x536b66};return yield this[_0x4da347(0x180)](_0x334e7d,api_1[_0x4da347(0x17c)]['ACCESS_TOKEN_REQUEST_URL']);});}static[a18_0x145dcf(0x161)](_0xe61617){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x22451b=a18_0x22a1;if(!(yield this[_0x22451b(0x14c)](_0xe61617)))throw new InvalidTokenSignatureError_1[(_0x22451b(0x135))](_0x22451b(0x178));_0xe61617[_0x22451b(0x14a)]('%')&&(_0xe61617=decodeURIComponent(_0xe61617));const _0x1d4ede={'clientId':process[_0x22451b(0x188)]['CAMDIGIKEY_CLIENT_ID'],'accessToken':_0xe61617};return yield this['requestToServer'](_0x1d4ede,api_1[_0x22451b(0x17c)][_0x22451b(0x181)]);});}static[a18_0x145dcf(0x184)](_0x7fd55b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5d6af2=a18_0x22a1;if(!(yield this[_0x5d6af2(0x14c)](_0x7fd55b)))throw new InvalidTokenSignatureError_1[(_0x5d6af2(0x135))](_0x5d6af2(0x178));_0x7fd55b['includes']('%')&&(_0x7fd55b=decodeURIComponent(_0x7fd55b));const _0x2458cd={'clientId':process[_0x5d6af2(0x188)][_0x5d6af2(0x162)],'accessToken':_0x7fd55b};return yield this['requestToServer'](_0x2458cd,api_1['CAMDIGIKEY_API'][_0x5d6af2(0x13d)]);});}static['lookupUserProfile'](_0x188777,_0x4e0720){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3024e3=a18_0x22a1;if(!(yield this[_0x3024e3(0x14c)](_0x188777)))throw new InvalidTokenSignatureError_1['default'](_0x3024e3(0x13c));_0x188777[_0x3024e3(0x14a)]('%')&&(_0x188777=decodeURIComponent(_0x188777));const _0x356e31={'clientId':process[_0x3024e3(0x188)][_0x3024e3(0x162)],'domain':process[_0x3024e3(0x188)][_0x3024e3(0x13b)],'accessToken':_0x188777,'personalCode':_0x4e0720};return yield this[_0x3024e3(0x180)](_0x356e31,api_1[_0x3024e3(0x17c)][_0x3024e3(0x148)]);});}static[a18_0x145dcf(0x150)](_0x7d574c){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x3ae17b=a18_0x22a1;if(!(yield this[_0x3ae17b(0x14c)](_0x7d574c)))throw new InvalidTokenSignatureError_1[(_0x3ae17b(0x135))](_0x3ae17b(0x13c));_0x7d574c['includes']('%')&&(_0x7d574c=decodeURIComponent(_0x7d574c));const _0x346d75={'clientId':process['env']['CAMDIGIKEY_CLIENT_ID'],'domain':process['env'][_0x3ae17b(0x13b)],'accountToken':_0x7d574c};return yield this['requestToServer'](_0x346d75,api_1['CAMDIGIKEY_API'][_0x3ae17b(0x159)]);});}};function a18_0x22a1(_0x90e805,_0x1b3c98){const _0x3b001f=a18_0x3b00();return a18_0x22a1=function(_0x22a1fe,_0x23ac42){_0x22a1fe=_0x22a1fe-0x12d;let _0x12adb0=_0x3b001f[_0x22a1fe];return _0x12adb0;},a18_0x22a1(_0x90e805,_0x1b3c98);}exports['CamDigiKeyClient']=CamDigiKeyClient;function a18_0x3b00(){const _0x19ed1f=['CAMDIGIKEY_API','__awaiter','12XgLrba','CamDigiKeyClient','requestToServer','ACCESS_TOKEN_REFRESH_URL','asn1','wrapRequest','logoutAccessToken','ORG_ACCESS_TOKEN_URL','string','apply','env','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','from','./crypto/DigestHelper','now','./api','./error/CamDigiKeyError','base64','4uoMJMC','480485XZUhPx','invalid.token.format','application/json','toDer','_cacheService','CAMDIGIKEY_SERVER_BASED_URL','X509Certificate','createVerify','default','export','oids','post','readFileSync','defineProperty','CAMDIGIKEY_CLIENT_DOMAIN','Invalid\x20access\x20token\x20signature','LOGOUT_USER_ACCESS_TOKEN_URL','then','pki','8627894cOaHAt','LOGIN_TOKEN_REQUEST_URL','verify','sha512','end','2546072BcLPrv','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','node-forge','LOOKUP_USER_PROFILE','getUserAccessToken','includes','1904985KRDcQb','validateTokenSignature','error','data','21XXowBb','verifyAccountToken','getOrganizationAccessToken','statusCode','split','init','__esModule','Invalid\x20auth\x20token\x20signature.','publicKey','./error/InvalidAccessTokenTypeError','VERIFY_USER_PROFILE','request','binary','getLoginToken','_trustedRootCert','done','certBag','spki','refreshUserAccessToken','CAMDIGIKEY_CLIENT_ID','unwrapResponse','__importDefault','pem','1531296gIWgob','231246JsAuuh','fromDer','agentOptions','CERTIFICATE','30roxdaC','ACCESS_TOKEN_STATUS_URL','value','./error/InvalidTokenSignatureError','389993xCaKMd','validateJwt','throw','digest','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE','./cache/CamDigiKeyMemoryCache','message','getBags','getBytes','Invalid\x20user\x20access\x20token\x20signature.','next','status','signerCertificate'];a18_0x3b00=function(){return _0x19ed1f;};return a18_0x3b00();}