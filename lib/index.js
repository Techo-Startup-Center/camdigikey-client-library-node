'use strict';const a18_0x2392f3=a18_0x16ff;function a18_0x6f69(){const _0x24632b=['statusCode','string','fromDer','CAMDIGIKEY_API','5fCegXp','CAMDIGIKEY_CLIENT_DOMAIN','unwrapResponse','Invalid\x20access\x20token\x20signature','CERTIFICATE','end','binary','error','from','data','VERIFY_USER_PROFILE','35tUhLab','init','./crypto/Wrapper','31580439BKYNoQ','2316282mDZGST','length','CAMDIGIKEY_SERVER_BASED_URL','ACCESS_TOKEN_REFRESH_URL','pem','_cacheService','pkcs12FromAsn1','validateTokenSignature','Invalid\x20user\x20access\x20token\x20signature.','crypto','RETRIEVE_FACE_URL','getOrganizationAccessToken','pki','9KMEeZQ','pkcs12','3237438Wexpyo','invalid.token.type','message','logoutAccessToken','verifyAccountToken','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','next','LOGOUT_USER_ACCESS_TOKEN_URL','85568hTIHqm','requestToServer','CAMDIGIKEY_CLIENT_ID','node-forge','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE','agentOptions','ACCESS_TOKEN_REQUEST_URL','request','value','application/json','createVerify','write','LOGIN_TOKEN_REQUEST_URL','./error/InvalidTokenSignatureError','9816534CSVatF','./cache/CamDigiKeyMemoryCache','sha512','default','__esModule','status','./api','publicKey','export','367452wpKKqa','apply','CAMDIGIKEY_CLIENT_TRUST_STORE_FILE_PASSWORD','__awaiter','__importDefault','includes','X509Certificate','getBytes','digest','env','spki','asn1','CamDigiKeyClient','ORG_ACCESS_TOKEN_URL','base64','ACCESS_TOKEN_STATUS_URL','getBags','validateJwt','10NXnHzJ','wrapRequest','_trustedRootCert','defineProperty','Error\x20requesting\x20to\x20CamDigiKey\x20Server.\x20Error:\x20','refreshUserAccessToken','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','oids','2064152xvMnGc','readFileSync','getUserAccessToken','./crypto/DigestHelper','lookupUserProfile','now','getUserFace','getLoginToken','post'];a18_0x6f69=function(){return _0x24632b;};return a18_0x6f69();}(function(_0x55c0d6,_0x354878){const _0x499890=a18_0x16ff,_0x4e6529=_0x55c0d6();while(!![]){try{const _0xd35c0c=-parseInt(_0x499890(0xab))/0x1+-parseInt(_0x499890(0x7d))/0x2+-parseInt(_0x499890(0x8a))/0x3*(-parseInt(_0x499890(0x94))/0x4)+parseInt(_0x499890(0xd2))/0x5*(-parseInt(_0x499890(0x8c))/0x6)+parseInt(_0x499890(0x79))/0x7*(-parseInt(_0x499890(0xc5))/0x8)+-parseInt(_0x499890(0xa2))/0x9*(-parseInt(_0x499890(0xbd))/0xa)+parseInt(_0x499890(0x7c))/0xb;if(_0xd35c0c===_0x354878)break;else _0x4e6529['push'](_0x4e6529['shift']());}catch(_0x2a4f52){_0x4e6529['push'](_0x4e6529['shift']());}}}(a18_0x6f69,0xa3b7e));var __awaiter=this&&this[a18_0x2392f3(0xae)]||function(_0x47b4e8,_0x5cf72a,_0x4e083b,_0x363b0a){function _0x5c74ae(_0x2d3830){return _0x2d3830 instanceof _0x4e083b?_0x2d3830:new _0x4e083b(function(_0xb403f2){_0xb403f2(_0x2d3830);});}return new(_0x4e083b||(_0x4e083b=Promise))(function(_0x3010b7,_0x441e39){const _0x3d67a6=a18_0x16ff;function _0x3b32df(_0x202fad){try{_0x662527(_0x363b0a['next'](_0x202fad));}catch(_0x1832f6){_0x441e39(_0x1832f6);}}function _0x43f32d(_0x1f049f){try{_0x662527(_0x363b0a['throw'](_0x1f049f));}catch(_0x1de565){_0x441e39(_0x1de565);}}function _0x662527(_0x587537){const _0x32df43=a18_0x16ff;_0x587537['done']?_0x3010b7(_0x587537[_0x32df43(0x9c)]):_0x5c74ae(_0x587537[_0x32df43(0x9c)])['then'](_0x3b32df,_0x43f32d);}_0x662527((_0x363b0a=_0x363b0a[_0x3d67a6(0xac)](_0x47b4e8,_0x5cf72a||[]))[_0x3d67a6(0x92)]());});},__importDefault=this&&this[a18_0x2392f3(0xaf)]||function(_0x1f9d3f){const _0x3cc49e=a18_0x2392f3;return _0x1f9d3f&&_0x1f9d3f[_0x3cc49e(0xa6)]?_0x1f9d3f:{'default':_0x1f9d3f};};Object[a18_0x2392f3(0xc0)](exports,a18_0x2392f3(0xa6),{'value':!![]}),exports[a18_0x2392f3(0xb7)]=void 0x0;const Wrapper_1=__importDefault(require(a18_0x2392f3(0x7b))),CamDigiKeyError_1=__importDefault(require('./error/CamDigiKeyError')),InvalidAccessTokenTypeError_1=__importDefault(require('./error/InvalidAccessTokenTypeError')),DigestHelper_1=__importDefault(require(a18_0x2392f3(0xc8))),CamDigiKeyMemoryCache_1=__importDefault(require(a18_0x2392f3(0xa3))),InvalidTokenSignatureError_1=__importDefault(require(a18_0x2392f3(0xa1))),fs_1=__importDefault(require('fs')),request_1=__importDefault(require(a18_0x2392f3(0x9b))),crypto_1=__importDefault(require(a18_0x2392f3(0x86))),node_forge_1=__importDefault(require(a18_0x2392f3(0x97))),api_1=require(a18_0x2392f3(0xa8)),CamDigiKeyClient=class{static['init'](){const _0x1f22c6=a18_0x2392f3,_0x3ec79c=fs_1[_0x1f22c6(0xa5)][_0x1f22c6(0xc6)](String(process[_0x1f22c6(0xb4)][_0x1f22c6(0x98)]),_0x1f22c6(0xd8)),_0x2c0136=node_forge_1[_0x1f22c6(0xa5)]['asn1'][_0x1f22c6(0xd0)](_0x3ec79c),_0x377c9c=node_forge_1[_0x1f22c6(0xa5)][_0x1f22c6(0x8b)][_0x1f22c6(0x83)](_0x2c0136,String(process[_0x1f22c6(0xb4)][_0x1f22c6(0xad)])),_0x51a512=_0x377c9c[_0x1f22c6(0xbb)]({'bagType':node_forge_1['default']['pki'][_0x1f22c6(0xc4)]['certBag']}),_0x5300a3=_0x51a512[node_forge_1[_0x1f22c6(0xa5)][_0x1f22c6(0x89)][_0x1f22c6(0xc4)]['certBag']][0x0],_0x5bd7b6={'type':_0x1f22c6(0xd6),'body':node_forge_1[_0x1f22c6(0xa5)][_0x1f22c6(0xb6)]['toDer'](_0x5300a3['asn1'])[_0x1f22c6(0xb2)]()},_0x3d79c6=node_forge_1[_0x1f22c6(0xa5)][_0x1f22c6(0x81)]['encode'](_0x5bd7b6);this[_0x1f22c6(0xbf)]=new crypto_1[(_0x1f22c6(0xa5))][(_0x1f22c6(0xb1))](_0x3d79c6),this['_cacheService']=new CamDigiKeyMemoryCache_1['default'](this[_0x1f22c6(0xbf)]);}static[a18_0x2392f3(0x95)](_0x445571,_0x28d3c4){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x58eee8=a18_0x16ff;try{const _0x1058e0=String(process['env'][_0x58eee8(0x7f)])+_0x28d3c4,_0x188a13=Wrapper_1[_0x58eee8(0xa5)][_0x58eee8(0xbe)](_0x445571),_0xcafd7c={'url':_0x1058e0,'headers':{'Content-Type':_0x58eee8(0x9d)},'json':_0x188a13};return process[_0x58eee8(0xb4)][_0x58eee8(0x91)]&&(_0xcafd7c[_0x58eee8(0x99)]={'pfx':fs_1[_0x58eee8(0xa5)][_0x58eee8(0xc6)](String(process['env'][_0x58eee8(0x91)])),'passphrase':String(process[_0x58eee8(0xb4)][_0x58eee8(0xc3)])}),yield new Promise((_0x3d36c5,_0x35582b)=>{const _0x243dbf=_0x58eee8;request_1[_0x243dbf(0xa5)][_0x243dbf(0xcd)](_0xcafd7c,(_0x3469e0,_0x396639,_0x35d101)=>{const _0x38f8a3=_0x243dbf;if(!_0x3469e0&&_0x396639[_0x38f8a3(0xce)]>=0xc8&&_0x396639[_0x38f8a3(0xce)]<0x12c){if(_0x35d101!=null)try{const _0x457582=Wrapper_1[_0x38f8a3(0xa5)][_0x38f8a3(0xd4)](_0x35d101);return _0x3d36c5(_0x457582);}catch(_0x2f1de0){return _0x35582b(_0x2f1de0);}else return _0x3d36c5({});}else return _0x35582b(new CamDigiKeyError_1[(_0x38f8a3(0xa5))](_0x38f8a3(0xc1)+(_0x3469e0===null||_0x3469e0===void 0x0?void 0x0:_0x3469e0[_0x38f8a3(0x8e)])));});});}catch(_0x1a98e5){throw new CamDigiKeyError_1[(_0x58eee8(0xa5))](_0x1a98e5[_0x58eee8(0x8e)]);}});}static['validateTokenSignature'](_0x246ec2){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x5759e0=a18_0x16ff;var _0x2316ae;!this[_0x5759e0(0x82)]&&this[_0x5759e0(0x7a)]();if(typeof _0x246ec2!==_0x5759e0(0xcf))throw new InvalidAccessTokenTypeError_1[(_0x5759e0(0xa5))](_0x5759e0(0x8d));_0x246ec2[_0x5759e0(0xb0)]('%')&&(_0x246ec2=decodeURIComponent(_0x246ec2));try{const _0x2e5808=_0x246ec2['split']('.');if(_0x2e5808[_0x5759e0(0x7e)]!==0x3)throw new InvalidAccessTokenTypeError_1[(_0x5759e0(0xa5))]('invalid.token.format');const _0x1fe0cb=_0x2e5808[0x0]+'.'+_0x2e5808[0x1],_0xb204a9=DigestHelper_1[_0x5759e0(0xa5)][_0x5759e0(0xb3)](Buffer[_0x5759e0(0x76)](_0x1fe0cb)),_0x3ba1b8=yield(_0x2316ae=this['_cacheService'])===null||_0x2316ae===void 0x0?void 0x0:_0x2316ae['signerCertificate'](),_0x34388b=Buffer['from'](_0x2e5808[0x2],_0x5759e0(0xb9)),_0x2ebabb=_0x3ba1b8===null||_0x3ba1b8===void 0x0?void 0x0:_0x3ba1b8[_0x5759e0(0xa9)],_0x2e7048=_0x2ebabb[_0x5759e0(0xaa)]({'type':_0x5759e0(0xb5),'format':_0x5759e0(0x81)}),_0xf1add9=crypto_1['default'][_0x5759e0(0x9e)](_0x5759e0(0xa4));_0xf1add9[_0x5759e0(0x9f)](_0xb204a9),_0xf1add9[_0x5759e0(0xd7)]();const _0x4edcd0=_0xf1add9['verify'](Buffer[_0x5759e0(0x76)](_0x2e7048),_0x34388b);return _0x4edcd0;}catch(_0xaf530d){return console[_0x5759e0(0x75)](_0xaf530d),![];}});}static[a18_0x2392f3(0xbc)](_0x3df381){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x52a5e5=a18_0x16ff;if(yield this[_0x52a5e5(0x84)](_0x3df381)){_0x3df381['includes']('%')&&(_0x3df381=decodeURIComponent(_0x3df381));const _0x115ef9={'clientId':process[_0x52a5e5(0xb4)][_0x52a5e5(0x96)],'accessToken':_0x3df381};try{let _0x1a59bb=yield this['requestToServer'](_0x115ef9,api_1[_0x52a5e5(0xd1)][_0x52a5e5(0xba)]);if(_0x1a59bb[_0x52a5e5(0x77)][_0x52a5e5(0xa7)])return{'is_valid':!![],'payload':_0x1a59bb};}catch(_0x4b892b){}}return{'is_valid':![],'payload':null};});}static[a18_0x2392f3(0x88)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x39c53a=a18_0x16ff,_0x1e1a55={'clientId':process[_0x39c53a(0xb4)][_0x39c53a(0x96)],'domain':process[_0x39c53a(0xb4)][_0x39c53a(0xd3)],'requestedDate':Date['now']()};return yield this[_0x39c53a(0x95)](_0x1e1a55,api_1[_0x39c53a(0xd1)][_0x39c53a(0xb8)]);});}static[a18_0x2392f3(0xcc)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x52b81d=a18_0x16ff,_0x3c02fa={'clientId':process[_0x52b81d(0xb4)][_0x52b81d(0x96)],'domain':process[_0x52b81d(0xb4)][_0x52b81d(0xd3)],'requestedDate':Date[_0x52b81d(0xca)]()};return yield this['requestToServer'](_0x3c02fa,api_1[_0x52b81d(0xd1)][_0x52b81d(0xa0)]);});}static[a18_0x2392f3(0xc7)](_0x11cbcb){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x36c74e=a18_0x16ff;if(!(yield this[_0x36c74e(0x84)](_0x11cbcb)))throw new InvalidTokenSignatureError_1['default']('Invalid\x20auth\x20token\x20signature.');_0x11cbcb[_0x36c74e(0xb0)]('%')&&(_0x11cbcb=decodeURIComponent(_0x11cbcb));const _0x6ee762={'clientId':process[_0x36c74e(0xb4)]['CAMDIGIKEY_CLIENT_ID'],'authToken':_0x11cbcb};return yield this['requestToServer'](_0x6ee762,api_1[_0x36c74e(0xd1)][_0x36c74e(0x9a)]);});}static[a18_0x2392f3(0xc2)](_0x59b8aa){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4f7e18=a18_0x16ff;if(!(yield this[_0x4f7e18(0x84)](_0x59b8aa)))throw new InvalidTokenSignatureError_1['default'](_0x4f7e18(0x85));_0x59b8aa[_0x4f7e18(0xb0)]('%')&&(_0x59b8aa=decodeURIComponent(_0x59b8aa));const _0x506ed1={'clientId':process['env'][_0x4f7e18(0x96)],'accessToken':_0x59b8aa};return yield this['requestToServer'](_0x506ed1,api_1[_0x4f7e18(0xd1)][_0x4f7e18(0x80)]);});}static[a18_0x2392f3(0x8f)](_0x4dde92){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x30da1c=a18_0x16ff;if(!(yield this[_0x30da1c(0x84)](_0x4dde92)))throw new InvalidTokenSignatureError_1[(_0x30da1c(0xa5))](_0x30da1c(0x85));_0x4dde92['includes']('%')&&(_0x4dde92=decodeURIComponent(_0x4dde92));const _0x15038f={'clientId':process[_0x30da1c(0xb4)][_0x30da1c(0x96)],'accessToken':_0x4dde92};return yield this[_0x30da1c(0x95)](_0x15038f,api_1[_0x30da1c(0xd1)][_0x30da1c(0x93)]);});}static[a18_0x2392f3(0xc9)](_0x3d18b6,_0x37891d){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x11419e=a18_0x16ff;if(!(yield this[_0x11419e(0x84)](_0x3d18b6)))throw new InvalidTokenSignatureError_1['default'](_0x11419e(0xd5));_0x3d18b6[_0x11419e(0xb0)]('%')&&(_0x3d18b6=decodeURIComponent(_0x3d18b6));const _0x587e56={'clientId':process[_0x11419e(0xb4)][_0x11419e(0x96)],'domain':process[_0x11419e(0xb4)][_0x11419e(0xd3)],'accessToken':_0x3d18b6,'personalCode':_0x37891d};return yield this[_0x11419e(0x95)](_0x587e56,api_1[_0x11419e(0xd1)]['LOOKUP_USER_PROFILE']);});}static[a18_0x2392f3(0x90)](_0x1bc92b){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x55e22f=a18_0x16ff;if(!(yield this[_0x55e22f(0x84)](_0x1bc92b)))throw new InvalidTokenSignatureError_1[(_0x55e22f(0xa5))](_0x55e22f(0xd5));_0x1bc92b[_0x55e22f(0xb0)]('%')&&(_0x1bc92b=decodeURIComponent(_0x1bc92b));const _0xc4ba44={'clientId':process[_0x55e22f(0xb4)][_0x55e22f(0x96)],'domain':process[_0x55e22f(0xb4)][_0x55e22f(0xd3)],'accountToken':_0x1bc92b};return yield this[_0x55e22f(0x95)](_0xc4ba44,api_1['CAMDIGIKEY_API'][_0x55e22f(0x78)]);});}static[a18_0x2392f3(0xcb)](_0x52e22c){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x50b063=a18_0x16ff;if(!(yield this[_0x50b063(0x84)](_0x52e22c)))throw new InvalidTokenSignatureError_1[(_0x50b063(0xa5))](_0x50b063(0xd5));_0x52e22c[_0x50b063(0xb0)]('%')&&(_0x52e22c=decodeURIComponent(_0x52e22c));const _0x474b9d={'clientId':process['env'][_0x50b063(0x96)],'accessToken':_0x52e22c};return yield this[_0x50b063(0x95)](_0x474b9d,api_1['CAMDIGIKEY_API'][_0x50b063(0x87)]);});}};function a18_0x16ff(_0x52b44b,_0x4443a1){const _0x6f6922=a18_0x6f69();return a18_0x16ff=function(_0x16ffa6,_0x324895){_0x16ffa6=_0x16ffa6-0x75;let _0x3a2a3c=_0x6f6922[_0x16ffa6];return _0x3a2a3c;},a18_0x16ff(_0x52b44b,_0x4443a1);}exports['CamDigiKeyClient']=CamDigiKeyClient;