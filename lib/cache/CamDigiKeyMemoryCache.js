'use strict';const a2_0x3f3e20=a2_0x19b2;(function(_0x9d1a64,_0x485d6b){const _0x1b1065=a2_0x19b2,_0x282d3e=_0x9d1a64();while(!![]){try{const _0x1384b0=-parseInt(_0x1b1065(0x195))/0x1+-parseInt(_0x1b1065(0x1bb))/0x2*(-parseInt(_0x1b1065(0x19c))/0x3)+parseInt(_0x1b1065(0x1cf))/0x4+parseInt(_0x1b1065(0x196))/0x5*(parseInt(_0x1b1065(0x1d0))/0x6)+parseInt(_0x1b1065(0x1b0))/0x7*(-parseInt(_0x1b1065(0x1b2))/0x8)+parseInt(_0x1b1065(0x1a8))/0x9+-parseInt(_0x1b1065(0x1c4))/0xa;if(_0x1384b0===_0x485d6b)break;else _0x282d3e['push'](_0x282d3e['shift']());}catch(_0x1c8dd3){_0x282d3e['push'](_0x282d3e['shift']());}}}(a2_0x36b4,0x44edf));var __awaiter=this&&this[a2_0x3f3e20(0x1a6)]||function(_0x59573f,_0x23e2ff,_0x53c26d,_0x56854b){function _0x4c39e5(_0x56129){return _0x56129 instanceof _0x53c26d?_0x56129:new _0x53c26d(function(_0x1197a0){_0x1197a0(_0x56129);});}return new(_0x53c26d||(_0x53c26d=Promise))(function(_0x2b1655,_0xde56b0){const _0x49a731=a2_0x19b2;function _0x16f010(_0x402c59){const _0x4ca631=a2_0x19b2;try{_0x3656c9(_0x56854b[_0x4ca631(0x19b)](_0x402c59));}catch(_0x180fbb){_0xde56b0(_0x180fbb);}}function _0x35f2b1(_0x51a803){const _0x4c9a7c=a2_0x19b2;try{_0x3656c9(_0x56854b[_0x4c9a7c(0x1b3)](_0x51a803));}catch(_0x5b90d6){_0xde56b0(_0x5b90d6);}}function _0x3656c9(_0x300f96){const _0x3cc8f5=a2_0x19b2;_0x300f96['done']?_0x2b1655(_0x300f96[_0x3cc8f5(0x19e)]):_0x4c39e5(_0x300f96[_0x3cc8f5(0x19e)])[_0x3cc8f5(0x1bc)](_0x16f010,_0x35f2b1);}_0x3656c9((_0x56854b=_0x56854b[_0x49a731(0x1a5)](_0x59573f,_0x23e2ff||[]))[_0x49a731(0x19b)]());});},__importDefault=this&&this[a2_0x3f3e20(0x190)]||function(_0x539e97){return _0x539e97&&_0x539e97['__esModule']?_0x539e97:{'default':_0x539e97};};Object[a2_0x3f3e20(0x1b7)](exports,a2_0x3f3e20(0x1be),{'value':!![]});const lokijs_1=__importDefault(require(a2_0x3f3e20(0x192))),crypto_1=__importDefault(require(a2_0x3f3e20(0x1bf))),request_1=__importDefault(require(a2_0x3f3e20(0x1c5))),fs_1=__importDefault(require('fs')),InvalidCertificateChainError_1=__importDefault(require(a2_0x3f3e20(0x1b6))),CamDigiKeyError_1=__importDefault(require(a2_0x3f3e20(0x1a2))),api_1=require(a2_0x3f3e20(0x1aa));class CamDigiKeyMemoryCache{constructor(_0x1eb216){const _0xa35645=a2_0x3f3e20;this[_0xa35645(0x1a7)]=_0x1eb216,this['_db']=new lokijs_1[(_0xa35645(0x1d2))](_0xa35645(0x197)),this['_signerCertificate']=this[_0xa35645(0x1cd)]['addCollection'](_0xa35645(0x198));}[a2_0x3f3e20(0x1ad)](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x4a7414=a2_0x19b2,_0x447d82=this[_0x4a7414(0x1a1)][_0x4a7414(0x1bd)]({'validDate':{'$gt':new Date()}});if(_0x447d82==null){const _0x2a4027=yield this[_0x4a7414(0x1c7)](),_0x58d7f9=_0x2a4027[_0x4a7414(0x1c6)],_0x414e78={'certificate':_0x2a4027[_0x4a7414(0x1d1)][0x0],'certificateChain':_0x2a4027[_0x4a7414(0x1a0)],'validDate':new Date(_0x58d7f9[_0x4a7414(0x1c1)])};return this[_0x4a7414(0x1a1)][_0x4a7414(0x1b9)](_0x414e78),new crypto_1[(_0x4a7414(0x1d2))][(_0x4a7414(0x1ae))](_0x414e78['certificate']);}else return new crypto_1[(_0x4a7414(0x1d2))][(_0x4a7414(0x1ae))](_0x447d82['certificate']);});}['getCertificateFromCamDigiKey'](){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x429319=a2_0x19b2,_0x3bf323={'url':String(process[_0x429319(0x193)][_0x429319(0x1a4)])+api_1[_0x429319(0x18f)]['ACCESS_TOKEN_CERT_URL'],'headers':{'Content-Type':_0x429319(0x1cc)}};return process['env'][_0x429319(0x19d)]&&(_0x3bf323[_0x429319(0x1c0)]={'pfx':fs_1[_0x429319(0x1d2)]['readFileSync'](String(process[_0x429319(0x193)]['CAMDIGIKEY_CLIENT_KEYSTORE_FILE'])),'passphrase':String(process['env'][_0x429319(0x191)])}),yield new Promise((_0x4fa4cd,_0x25e1ed)=>{const _0x50a022=_0x429319;request_1[_0x50a022(0x1d2)]['get'](_0x3bf323,(_0x1411b7,_0x1a0897,_0x34b51b)=>{const _0x320c12=_0x50a022;if(!_0x1411b7&&_0x1a0897['statusCode']>=0xc8&&_0x1a0897[_0x320c12(0x1af)]<0x12c&&_0x34b51b!=null){const _0x4e6dd2=JSON[_0x320c12(0x199)](_0x34b51b),_0x4325f3=[],_0x2172c9={'cert_chain':_0x4e6dd2[_0x320c12(0x1c8)],'cert_chain_str':_0x34b51b};for(const _0xe188e9 of _0x4e6dd2[_0x320c12(0x1c8)]){_0x4325f3[_0x320c12(0x1a9)](new crypto_1[(_0x320c12(0x1d2))]['X509Certificate'](Buffer[_0x320c12(0x1b4)](_0xe188e9)));}if(this[_0x320c12(0x1b1)](this[_0x320c12(0x1a7)],_0x4325f3)){const _0x4e413d=new Date(_0x4325f3[0x0][_0x320c12(0x1c1)]);return _0x4e413d['getTime']()>Date[_0x320c12(0x1b8)]()?_0x4fa4cd(Object[_0x320c12(0x1c3)](Object[_0x320c12(0x1c3)]({},_0x2172c9),{'signer_cert':_0x4325f3[0x0]})):_0x25e1ed(new InvalidCertificateChainError_1[(_0x320c12(0x1d2))](_0x320c12(0x194)));}else return _0x25e1ed(new InvalidCertificateChainError_1[(_0x320c12(0x1d2))]('Invalid\x20certificate\x20chain\x20validation\x20of\x20signer\x20certificate'));}else return _0x25e1ed(new CamDigiKeyError_1[(_0x320c12(0x1d2))](_0x320c12(0x1c2)+(_0x1411b7===null||_0x1411b7===void 0x0?void 0x0:_0x1411b7[_0x320c12(0x1c9)])));});});});}[a2_0x3f3e20(0x1b1)](_0x35ed86,_0x20a3db){const _0x5ee433=a2_0x3f3e20;let _0x419e12=0x0;for(let _0x139217=0x0;_0x139217<_0x20a3db[_0x5ee433(0x1ba)];++_0x139217){let _0x27771d=![];for(let _0x32ba92=0x0;_0x32ba92<_0x20a3db['length'];++_0x32ba92){if(this[_0x5ee433(0x1ab)](_0x35ed86,_0x20a3db[_0x32ba92])){if(_0x20a3db[_0x32ba92][_0x5ee433(0x1ce)](_0x35ed86[_0x5ee433(0x1a3)])){++_0x419e12,_0x27771d=!![];break;}}else{if(this[_0x5ee433(0x1ab)](_0x20a3db[_0x139217],_0x20a3db[_0x32ba92])){if(_0x20a3db[_0x32ba92][_0x5ee433(0x1ce)](_0x20a3db[_0x139217][_0x5ee433(0x1a3)])){++_0x419e12,_0x27771d=!![];break;}}}}if(!_0x27771d)return![];}return _0x419e12===_0x20a3db[_0x5ee433(0x1ba)];}[a2_0x3f3e20(0x1ab)](_0x161d26,_0x4a9ef4){const _0x1c3029=a2_0x3f3e20,_0x1df8b0=_0x161d26[_0x1c3029(0x1ac)][_0x1c3029(0x19f)]('\x0a')[_0x1c3029(0x1ca)]((_0x32a795,_0x4b9da5)=>_0x32a795[_0x1c3029(0x19a)](_0x4b9da5)),_0x4e2b04=_0x4a9ef4[_0x1c3029(0x1ac)][_0x1c3029(0x19f)]('\x0a')[_0x1c3029(0x1ca)]((_0x12ffa5,_0x1874ba)=>_0x12ffa5[_0x1c3029(0x19a)](_0x1874ba));if(_0x1df8b0[_0x1c3029(0x1ba)]!=_0x4e2b04[_0x1c3029(0x1ba)])return![];return _0x1df8b0[_0x1c3029(0x1b5)](_0x43c7a8=>_0x4e2b04[_0x1c3029(0x1cb)](_0x43c7a8));}}function a2_0x19b2(_0x16c226,_0x5f4bda){const _0x36b4d9=a2_0x36b4();return a2_0x19b2=function(_0x19b203,_0x4d1f7f){_0x19b203=_0x19b203-0x18f;let _0x241c8b=_0x36b4d9[_0x19b203];return _0x241c8b;},a2_0x19b2(_0x16c226,_0x5f4bda);}exports['default']=CamDigiKeyMemoryCache;function a2_0x36b4(){const _0x30f843=['crypto','agentOptions','validTo','Error\x20requesting\x20to\x20CamDigiKey\x20Server.\x20Error:\x20','assign','776990illvww','request','signer_cert','getCertificateFromCamDigiKey','data','message','sort','includes','application/json','_db','verify','820600KWjttg','62100KMHnSd','cert_chain','default','CAMDIGIKEY_API','__importDefault','CAMDIGIKEY_CLIENT_KEYSTORE_FILE_PASSWORD','lokijs','env','Invalid\x20certificate\x20chain\x20validation\x20of\x20signer\x20certificate','403385wzGfXf','160lIWEWU','camdigikey-cache','camdigikey_signer_certificates','parse','localeCompare','next','246nMrPFD','CAMDIGIKEY_CLIENT_KEYSTORE_FILE','value','split','cert_chain_str','_signerCertificate','../error/CamDigiKeyError','publicKey','CAMDIGIKEY_SERVER_BASED_URL','apply','__awaiter','_trustedRootCert','1816173uzeRrM','push','../api','compareTwoPrincipals','subject','signerCertificate','X509Certificate','statusCode','963977pRIDal','verifyCertificateChain','16KRwhux','throw','from','every','../error/InvalidCertificateChainError','defineProperty','now','insert','length','7334RgumAb','then','findOne','__esModule'];a2_0x36b4=function(){return _0x30f843;};return a2_0x36b4();}